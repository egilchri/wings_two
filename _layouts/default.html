<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <link href="{{ '/style.css' | relative_url }}" rel="stylesheet" type="text/css" />
    <title>{{ page.title }}</title>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-49F7ZDY541"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-49F7ZDY541');
    </script>    
</head>
<body>
    <div class="calibre" id="calibre_link-0">
        
        <div style="background: #fdfdfd; padding: 20px; border: 1px solid #eee; border-radius: 12px; margin: 25px 0; text-align: center; font-family: sans-serif; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
            <h3 style="margin-top: 0; color: #444; font-size: 1.2em;">ðŸŽ§ Audiobook Navigator</h3>
            <p style="font-size: 0.9em; color: #666;">Quickly jump to a chapter by typing its name below.</p>
            
            <div style="margin-bottom: 15px;">
                <input type="text" id="chapterSearch" placeholder="e.g. Chapter II" style="padding: 8px; width: 180px; border-radius: 5px; border: 1px solid #ccc;">
                <button onclick="jumpToChapter()" style="padding: 8px 15px; border-radius: 5px; background: #007aff; color: white; border: none; cursor: pointer; font-weight: bold;">Jump</button>
            </div>
            
            <div id="active-chapter" style="font-weight: bold; color: #007aff; margin-bottom: 10px; min-height: 1.2em;">Introduction</div>
            
            <audio id="audioPlayer" controls preload="metadata" style="width: 100%; max-width: 450px; margin-bottom: 12px;">

               <source src="https://media.githubusercontent.com/media/egilchri/wings_two/main/wings_two_all.mp3" type="audio/mpeg">

            </audio>
        </div>

        {{ content }}

    </div>

    <script>
        // Chapter mapping (seconds). Note: Update these numbers via your Python script!
        const chapterMap = {
            "chapter 1": 0,
            "chapter 2": 2133,
            "chapter 3": 4705,
            "chapter 4": 7502,
            "chapter 5": 11424,
            "chapter 6": 15985,
            "chapter 7": 19852,
            "chapter 8": 21703,
            "chapter 9": 24428,
            "chapter 10": 28097,
            "chapter 11": 30822,
            "chapter 12": 33393,
            "chapter 13": 38359,
            "chapter 14": 41018,
            "chapter 15": 44291,
            "chapter 16": 48323,
            "chapter 17": 51013,
            "chapter 18": 54483,
            "chapter 19": 57470,
            "chapter 20": 59417,
            "chapter 21": 61651,
          };
        const player = document.getElementById('audioPlayer');
        const searchInput = document.getElementById('chapterSearch');
        const display = document.getElementById('active-chapter');

        function jumpToChapter() {
            const query = searchInput.value.toLowerCase().trim();
            if (chapterMap[query] !== undefined) {
                player.currentTime = chapterMap[query];
                player.play();
            } else { 
                alert("Chapter not recognized. Try 'Chapter II' or 'Chapter III'."); 
            }
        }

        // Listen for "Enter" key in the search box
        searchInput.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                jumpToChapter();
            }
        });

        player.addEventListener('timeupdate', () => {
            let current = "Introduction";
            for (const [name, time] of Object.entries(chapterMap)) {
                if (player.currentTime >= time) { 
                    current = name.toUpperCase(); 
                }
            }
            display.innerText = "Currently Playing: " + current;
        });
    </script>
</body>
</html>
